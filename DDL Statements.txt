CREATE SCHEMA bookstore;
SET SEARCH_PATH TO bookstore;

CREATE TABLE Category
(
	CategoryID		INTEGER PRIMARY KEY CHECK(CategoryID >= 0),
	Name			VARCHAR(50) NOT NULL CHECK(Name <> ' '),
	CategoryType 		VARCHAR(20) NOT NULL CHECK(CategoryType IN ('fiction', 'Non-fiction'))

);

CREATE TABLE SalesRep
(
	SalesRepID		INTEGER PRIMARY KEY CHECK(SalesRepID >= 0),
	Name			VARCHAR(50) NOT NULL CHECK(Name <> ' ')
);

CREATE TABLE Shop
(
	ShopID			INTEGER PRIMARY KEY CHECK(ShopID >= 0),
	Name			VARCHAR(50) NOT NULL CHECK(Name <> ' ') 
);

CREATE TABLE Publisher
(
	PublisherID		INTEGER PRIMARY KEY CHECK(PublisherID >= 0),
	Name			VARCHAR(50) NOT NULL CHECK(Name <> ' ') 
);

CREATE TABLE Book
(
	BookID			INTEGER PRIMARY KEY CHECK(BookID >= 0),
	Title			VARCHAR(50) NOT NULL UNIQUE CHECK(Title <> ' '),
	Price			DECIMAL(10,2) NOT NULL CHECK(Price >= 0),
	CategoryID		INTEGER NOT NULL CHECK(CategoryID >= 0),
	PublisherID		INTEGER NOT NULL CHECK(PublisherID >= 0),

	FOREIGN KEY(CategoryID) REFERENCES Category ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY(PublisherID) REFERENCES Publisher ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE ShopOrder
(
	ShopOrderID		INTEGER PRIMARY KEY CHECK(ShopOrderID >= 0),
	OrderDate		DATE NOT NULL CHECK(OrderDate >= '2000-01-01'),
	ShopID			INTEGER NOT NULL CHECK(ShopID >= 0),
	SalesRepID		INTEGER NOT NULL CHECK(SalesRepID >= 0),

	FOREIGN KEY(ShopID) REFERENCES Shop ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY(SalesRepID) REFERENCES SalesRep ON UPDATE CASCADE ON DELETE CASCADE
	
);

CREATE TABLE Orderline
(
	ShopOrderID		INTEGER NOT NULL CHECK(ShopOrderID >= 0),
	BookID			INTEGER NOT NULL CHECK(BookID >= 0),
	Quantity		INTEGER NOT NULL CHECK(Quantity > 0),
	UnitSellingPrice	DECIMAL (10,2) NOT NULL CHECK(UnitSellingPrice > 0),

	CONSTRAINT ol_pk PRIMARY KEY(ShopOrderID, BookID),
	FOREIGN KEY(ShopOrderID) REFERENCES ShopOrder ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY(BookID) REFERENCES Book ON UPDATE CASCADE ON DELETE CASCADE
		
);